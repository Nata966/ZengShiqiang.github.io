import React, { useState, useEffect, useRef } from 'react';
import { Shield, Target, Lock, Unlock, Activity, Map as MapIcon, Cpu, ChevronRight, Sword, Database, Crosshair, AlertTriangle, Layers, DollarSign, Wrench, Box, Scale } from 'lucide-react';

/**
 * PROJECT: MERCENARY 2026 - FULL STRATEGIC WHITE PAPER EDITION
 * * Chief Creative Technologist Note:
 * Fixed: Removed unused imports (Zap, BarChart2, Anchor, Users) to prevent linting errors.
 * Fixed: Aliased 'Map' to 'MapIcon' to avoid shadowing the global JavaScript Map object.
 * Visuals: 'Scale' icon confirmed for Section 11 equilibrium.
 */

// --- Custom Hooks (Unchanged for performance) ---

const useOnScreen = (options) => {
  const ref = useRef(null);
  const [isVisible, setIsVisible] = useState(false);
  useEffect(() => {
    const observer = new IntersectionObserver(([entry]) => {
      if (entry.isIntersecting) {
        setIsVisible(true);
        observer.disconnect();
      }
    }, options);
    if (ref.current) observer.observe(ref.current);
    return () => { if (ref.current) observer.unobserve(ref.current); };
  }, [ref, options]);
  return [ref, isVisible];
};

const useCountUp = (end, duration = 2000, start = 0) => {
  const [count, setCount] = useState(start);
  const [ref, isVisible] = useOnScreen({ threshold: 0.5 });
  useEffect(() => {
    if (!isVisible) return;
    let startTime;
    const animate = (currentTime) => {
      if (!startTime) startTime = currentTime;
      const progress = Math.min((currentTime - startTime) / duration, 1);
      setCount(Math.floor(progress * (end - start) + start));
      if (progress < 1) requestAnimationFrame(animate);
    };
    requestAnimationFrame(animate);
  }, [isVisible, end, duration, start]);
  return [ref, count];
};

// --- UI Components ---

const GlitchText = ({ text, subtext }) => {
  return (
    <div className="relative group cursor-default">
      <h1 className="text-4xl md:text-5xl lg:text-7xl font-black tracking-tighter text-white mb-2 relative z-10 mix-blend-difference font-sans">
        {text}
      </h1>
      <div className="text-cyan-400 text-sm md:text-base font-mono tracking-[0.15em] uppercase opacity-80">
        {subtext}
      </div>
      <div className="absolute top-0 left-1 w-full h-full text-4xl md:text-7xl font-black tracking-tighter text-red-600 opacity-0 group-hover:opacity-40 animate-pulse pointer-events-none z-0 translate-x-[2px]">{text}</div>
      <div className="absolute top-0 -left-1 w-full h-full text-4xl md:text-7xl font-black tracking-tighter text-blue-600 opacity-0 group-hover:opacity-40 animate-pulse pointer-events-none z-0 translate-x-[-2px] delay-75">{text}</div>
    </div>
  );
};

const SectionHeader = ({ title, number }) => (
  <div className="flex items-center space-x-3 mb-4 border-b border-[#1F2833] pb-2">
    <span className="text-cyan-400 font-mono text-lg">/{number.toString().padStart(2, '0')}</span>
    <h3 className="text-white font-bold uppercase tracking-wider text-sm md:text-base font-sans truncate">{title}</h3>
  </div>
);

const DecryptButton = ({ hiddenText }) => {
  const [decrypted, setDecrypted] = useState(false);
  return (
    <div className="mt-4">
      {!decrypted ? (
        <button onClick={() => setDecrypted(true)} className="group relative inline-flex items-center justify-center px-6 py-3 w-full overflow-hidden font-mono text-sm tracking-tighter text-white bg-gray-900 border border-red-500/50 rounded-sm hover:bg-red-900/20 transition-all shadow-[0_0_10px_rgba(239,68,68,0.2)]">
          <span className="absolute w-0 h-0 transition-all duration-500 ease-out bg-red-600 rounded-full group-hover:w-96 group-hover:h-96 opacity-10"></span>
          <span className="relative flex items-center gap-2">
            <Lock size={16} className="text-red-500 animate-pulse" />
            <span className="text-red-100">CLASSIFIED // DECRYPT FINANCIALS</span>
          </span>
        </button>
      ) : (
        <div className="p-4 border-l-2 border-cyan-400 bg-cyan-900/10 animate-in fade-in slide-in-from-left-4 duration-500">
          <div className="flex items-center gap-2 mb-2 text-cyan-400 font-mono text-xs uppercase"><Unlock size={14} /><span>Protocol Unlocked</span></div>
          <p className="text-gray-300 leading-relaxed font-sans text-xs md:text-sm whitespace-pre-line">{hiddenText}</p>
        </div>
      )}
    </div>
  );
};

const GridCard = ({ children, colSpan = "md:col-span-4", className = "" }) => (
  <div className={`${colSpan} bg-[#1F2833]/30 border border-gray-800 p-6 rounded-sm backdrop-blur-sm relative overflow-hidden hover:border-cyan-900/50 transition-colors ${className}`}>
    {children}
  </div>
);

const ListItem = ({ children, icon: Icon = ChevronRight, color = "text-cyan-400" }) => (
  <div className="flex items-start gap-2 mb-2 group">
    <div className={`mt-1 p-0.5 bg-gray-900/50 rounded-sm border border-gray-700 group-hover:border-${color.split('-')[1]}-400 transition-colors`}>
      <Icon className={`${color} shrink-0`} size={12} />
    </div>
    <span className="text-gray-300 text-xs md:text-sm leading-snug">{children}</span>
  </div>
);

// --- Main Application Component ---

const App = () => {
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const timer = setTimeout(() => setLoading(false), 1500);
    return () => clearTimeout(timer);
  }, []);

  if (loading) {
    return (
      <div className="fixed inset-0 bg-[#0B0C10] flex items-center justify-center z-50">
        <div className="text-center font-mono">
          <div className="text-cyan-500 text-xl animate-pulse mb-4 tracking-widest">LOADING TACTICAL MAP...</div>
          <div className="w-48 h-1 bg-gray-800 mx-auto rounded-full overflow-hidden">
            <div className="h-full bg-cyan-400 animate-[loading_1.5s_ease-in-out_infinite]"></div>
          </div>
          <style>{`@keyframes loading { 0% { width: 0%; margin-left: 0; } 50% { width: 100%; margin-left: 0; } 100% { width: 0%; margin-left: 100%; } }`}</style>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-[#0B0C10] text-gray-300 font-sans selection:bg-cyan-900 selection:text-cyan-100 overflow-x-hidden pb-20">
      
      {/* Background Grid */}
      <div className="fixed inset-0 pointer-events-none opacity-[0.04] z-0" style={{ backgroundImage: `linear-gradient(#66FCF1 1px, transparent 1px), linear-gradient(90deg, #66FCF1 1px, transparent 1px)`, backgroundSize: '40px 40px' }}></div>

      <div className="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 md:py-16">
        
        {/* HERO SECTION */}
        <header className="mb-12">
          <div className="border-l-4 border-cyan-400 pl-6 py-2">
            <GlitchText text="PROJECT: MERCENARY" subtext="2026 數位媒體事業體戰略白皮書" />
          </div>
          <div className="mt-6 flex flex-wrap gap-4 text-xs font-mono text-gray-500">
             <span className="flex items-center gap-2"><span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>ONLINE</span>
             <span>|</span>
             <span>UNIT: SMU-ALPHA</span>
             <span>|</span>
             <span>TARGET: B2B DOMINATION</span>
          </div>
        </header>

        {/* --- GRID SYSTEM START (12 Columns) --- */}
        <div className="grid grid-cols-1 md:grid-cols-12 gap-4 auto-rows-min">
          
          {/* 1. 市場分析 (Battlefield) & 2. 利益空缺口 (Opportunity Gap) */}
          <GridCard colSpan="md:col-span-8">
            {/* FIXED: Use MapIcon alias */}
            <div className="absolute top-0 right-0 p-4 opacity-10"><MapIcon size={120} /></div>
            <SectionHeader number={1} title="Battlefield & Opportunity (市場與缺口)" />
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
               <div>
                  <h4 className="text-red-400 font-bold text-sm mb-2 flex items-center gap-2"><AlertTriangle size={14}/> 市場極端化</h4>
                  <div className="space-y-2">
                     <div className="bg-red-900/20 p-2 border-l-2 border-red-800 text-xs">
                        <strong className="text-gray-200">左端：低價紅海 (SOHO)</strong><br/>無商業邏輯、品質參差
                     </div>
                     <div className="bg-red-900/20 p-2 border-l-2 border-red-800 text-xs">
                        <strong className="text-gray-200">右端：高價黑箱 (廣代)</strong><br/>人治色彩重、溝通成本高
                     </div>
                  </div>
               </div>
               <div>
                  <h4 className="text-cyan-400 font-bold text-sm mb-2 flex items-center gap-2"><Crosshair size={14}/> 利益空缺口</h4>
                  <div className="bg-cyan-900/20 p-3 border border-cyan-700/50 h-full rounded-sm">
                     <p className="text-sm text-white font-bold mb-1">中間戰場：工業化部隊</p>
                     <p className="text-xs text-gray-400">中大型企業需要的是「可控預算 + 穩定品質 + 數據成效」。這是從手工業轉向精密工業的暴利機會。</p>
                  </div>
               </div>
            </div>
          </GridCard>

          {/* 3. 集團施力點 (Leverage) */}
          <GridCard colSpan="md:col-span-4">
             <SectionHeader number={3} title="Why Us? (集團施力點)" />
             <div className="space-y-3 mt-4">
                <ListItem icon={Sword} color="text-red-400"><strong>軟實力：</strong>帝王學管理哲學 (制度背書)</ListItem>
                <ListItem icon={Database} color="text-blue-400"><strong>硬實力：</strong>潛在頂級攝影棚 (軍火庫)</ListItem>
                <ListItem icon={Cpu} color="text-cyan-400"><strong>戰鬥力：</strong>數據技術團隊 (SOP建構)</ListItem>
             </div>
          </GridCard>

          {/* 4. 戰略定位 (Identity) - NEW SECTION */}
          <GridCard colSpan="md:col-span-4">
             <div className="absolute top-0 right-0 p-3 opacity-10"><Shield size={80} /></div>
             <SectionHeader number={4} title="Identity (戰略定位)" />
             <div className="bg-gray-900/50 p-3 border border-gray-700 rounded-sm mb-3">
                <div className="text-xs text-gray-500 uppercase font-mono mb-1">UNIT DEFINITION</div>
                <div className="text-white font-bold text-sm">正規軍底下的「獨立傭兵」</div>
                <div className="text-xs text-gray-400 mt-1">自負盈虧 / 隨插即用</div>
             </div>
             <div className="space-y-2">
                <h4 className="text-xs font-bold text-gray-300">政治防護：去標籤化</h4>
                <ListItem icon={Unlock} color="text-green-400">榮耀歸於品牌 (去個人化)</ListItem>
                <ListItem icon={Lock} color="text-red-400">責任歸於制度 (SOP回應)</ListItem>
             </div>
          </GridCard>

          {/* 5. 產品戰略 (Product Strategy) */}
          <GridCard colSpan="md:col-span-4">
             <SectionHeader number={5} title="Core Weapons (三大鐵律)" />
             <div className="space-y-3 mt-2">
                <div className="group border-b border-gray-800 pb-2">
                   <div className="flex justify-between items-center text-sm font-bold text-gray-200">
                      <span>1. 菜單化 (Menu-ization)</span>
                      <Target size={14} className="text-cyan-500 opacity-50 group-hover:opacity-100"/>
                   </div>
                   <div className="text-xs text-gray-500 mt-1">拒絕客製化。模組A(導購) / 模組B(形象)。</div>
                </div>
                <div className="group border-b border-gray-800 pb-2">
                   <div className="flex justify-between items-center text-sm font-bold text-gray-200">
                      <span>2. 透明化 (Transparency)</span>
                      <Activity size={14} className="text-cyan-500 opacity-50 group-hover:opacity-100"/>
                   </div>
                   <div className="text-xs text-gray-500 mt-1">先小人後君子。隱形菜單明碼標價。</div>
                </div>
                <div className="group">
                   <div className="flex justify-between items-center text-sm font-bold text-gray-200">
                      <span>3. 標準化 (Standard)</span>
                      <Layers size={14} className="text-cyan-500 opacity-50 group-hover:opacity-100"/>
                   </div>
                   <div className="text-xs text-gray-500 mt-1">SOP流水線生產，確保品質恆定。</div>
                </div>
             </div>
          </GridCard>

          {/* 6. 商業模式 (Business Model) */}
          <GridCard colSpan="md:col-span-4" className="flex flex-col justify-between">
             <SectionHeader number={6} title="Business Model (雙引擎)" />
             <div className="grid grid-cols-2 gap-3 h-full">
                <div className="bg-gradient-to-br from-gray-900 to-gray-800 p-3 rounded-sm border border-gray-700 flex flex-col justify-center text-center">
                   <div className="text-xs text-gray-400 font-mono mb-1">ENGINE 01</div>
                   <div className="text-red-400 font-bold text-sm">數位轉型建置費</div>
                   <div className="text-2xl text-white font-mono font-bold my-1">$300K+</div>
                   <div className="text-[10px] text-gray-500">IP設計 / 創造利潤</div>
                </div>
                <div className="bg-gradient-to-br from-gray-900 to-gray-800 p-3 rounded-sm border border-gray-700 flex flex-col justify-center text-center">
                   <div className="text-xs text-gray-400 font-mono mb-1">ENGINE 02</div>
                   <div className="text-cyan-400 font-bold text-sm">媒體管家維運費</div>
                   <div className="text-2xl text-white font-mono font-bold my-1">$50K/mo</div>
                   <div className="text-[10px] text-gray-500">維穩 / 現金流</div>
                </div>
             </div>
          </GridCard>

          {/* 7. 建軍路徑 (Roadmap) */}
          <GridCard colSpan="md:col-span-4">
             <SectionHeader number={7} title="Roadmap (建軍路徑)" />
             <div className="relative pl-4 border-l border-gray-800 space-y-4 font-mono text-xs mt-3">
                <div className="relative">
                   <div className="absolute -left-[21px] top-1 w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                   <span className="text-green-500 font-bold">PHASE 1 (0-6M)</span>
                   <p className="text-gray-400 mt-1">潛龍勿用：內部練兵，SOP建置。</p>
                </div>
                <div className="relative opacity-70">
                   <div className="absolute -left-[21px] top-1 w-2 h-2 bg-gray-600 rounded-full"></div>
                   <span className="text-gray-300 font-bold">PHASE 2 (6-18M)</span>
                   <p className="text-gray-500 mt-1">見龍在田：生存扎根，累積15客戶。</p>
                </div>
                <div className="relative opacity-40">
                   <div className="absolute -left-[21px] top-1 w-2 h-2 bg-gray-600 rounded-full"></div>
                   <span className="text-gray-500 font-bold">PHASE 3 (18M+)</span>
                   <p className="text-gray-600 mt-1">飛龍在天：進軍標案，規模擴張。</p>
                </div>
             </div>
          </GridCard>

          {/* 8. 內務建設 (Internal Infrastructure) - NEW SECTION */}
          <GridCard colSpan="md:col-span-4">
             <SectionHeader number={8} title="Internal Infra (內務建設)" />
             <div className="grid grid-cols-2 gap-2 mt-2">
                <div className="bg-gray-900/40 p-2 rounded-sm border border-gray-800">
                   <div className="flex items-center gap-2 text-cyan-400 mb-1"><DollarSign size={12}/> <span className="text-xs font-bold">收費制度化</span></div>
                   <div className="text-[10px] text-gray-500">內部計價單、規格書</div>
                </div>
                <div className="bg-gray-900/40 p-2 rounded-sm border border-gray-800">
                   <div className="flex items-center gap-2 text-cyan-400 mb-1"><Crosshair size={12}/> <span className="text-xs font-bold">企劃數據化</span></div>
                   <div className="text-[10px] text-gray-500">戰前偵蒐表、腳本庫</div>
                </div>
                <div className="bg-gray-900/40 p-2 rounded-sm border border-gray-800">
                   <div className="flex items-center gap-2 text-cyan-400 mb-1"><Wrench size={12}/> <span className="text-xs font-bold">後製流程化</span></div>
                   <div className="text-[10px] text-gray-500">中央素材庫、工程目錄</div>
                </div>
                <div className="bg-gray-900/40 p-2 rounded-sm border border-gray-800">
                   <div className="flex items-center gap-2 text-cyan-400 mb-1"><Box size={12}/> <span className="text-xs font-bold">後勤編制化</span></div>
                   <div className="text-[10px] text-gray-500">3-2-1 備份、維修履歷</div>
                </div>
             </div>
          </GridCard>

          {/* 9. 軍備擴充 (Arsenal Acquisition) - NEW SECTION */}
          <GridCard colSpan="md:col-span-4">
             <div className="absolute top-0 right-0 p-3 opacity-10"><Database size={80} /></div>
             <SectionHeader number={9} title="Arsenal (軍備擴充)" />
             <div className="space-y-3 mt-2">
                <div className="flex items-start gap-2 bg-red-900/10 p-2 rounded-sm border border-red-900/30">
                   <AlertTriangle className="text-red-500 shrink-0 mt-0.5" size={14} />
                   <div>
                      <div className="text-red-400 text-xs font-bold">風險揭露：資產空洞化</div>
                      <div className="text-[10px] text-gray-500 leading-tight">目前產能依賴顧問私有設備，不符長治久安。</div>
                   </div>
                </div>
                <div>
                   <h4 className="text-xs font-bold text-gray-300 mb-1">行動：抄底時刻 (Market Timing)</h4>
                   <p className="text-xs text-gray-400 leading-relaxed">
                      AI 衝擊導致工作室倒閉潮。策略：<strong className="text-white">降維打擊採購法</strong>，以 30% 預算收購 2-3 年前頂級電影設備 (RED/Arri)。
                   </p>
                </div>
             </div>
          </GridCard>

          {/* 10. 組織編制 (Organization) - NEW SECTION */}
          <GridCard colSpan="md:col-span-6">
             <SectionHeader number={10} title="Organization (鐵三角戰鬥群)" />
             <div className="flex justify-around items-center mt-6 relative h-32">
                {/* Visual Connection Lines */}
                <div className="absolute top-1/2 left-10 right-10 h-0.5 bg-gray-800 -z-10"></div>
                <div className="absolute top-10 bottom-10 left-1/2 w-0.5 bg-gray-800 -z-10"></div>

                <div className="text-center bg-[#0B0C10] p-2 z-10 border border-gray-700 rounded-sm w-28">
                   <div className="text-cyan-400 font-bold text-sm mb-1">PM 指揮官</div>
                   <div className="text-[10px] text-gray-500">對外擋箭牌<br/>制度回應</div>
                </div>
                
                <div className="text-center bg-[#0B0C10] p-2 z-10 border border-gray-700 rounded-sm w-28 scale-110 shadow-[0_0_15px_rgba(0,0,0,0.5)] border-cyan-500/50">
                   <div className="text-white font-bold text-sm mb-1">企劃參謀</div>
                   <div className="text-[10px] text-gray-500">數據大腦<br/>模組產出</div>
                </div>
                
                <div className="text-center bg-[#0B0C10] p-2 z-10 border border-gray-700 rounded-sm w-28">
                   <div className="text-red-400 font-bold text-sm mb-1">製作特種兵</div>
                   <div className="text-[10px] text-gray-500">執行手腳<br/>技術產出</div>
                </div>
             </div>
          </GridCard>

          {/* 11. 收支正平衡 (Financial Equilibrium) - Includes Decrypt Button */}
          <GridCard colSpan="md:col-span-6">
             {/* VISUAL FIX: Added Scale Icon for Visual Consistency */}
             <div className="absolute top-0 right-0 p-3 opacity-10"><Scale size={80} /></div>
             
             <SectionHeader number={11} title="Financial Equilibrium (收支平衡)" />
             <div className="flex flex-col h-full justify-between">
                <div className="text-sm text-gray-300 font-mono mb-2">
                   平衡公式：<br/>
                   <span className="text-green-400">(建置費 / 攤提) + 維運費</span> {'>'} <span className="text-red-400">固定成本</span>
                </div>
                <div className="bg-gray-800/50 p-3 rounded-sm text-xs text-gray-400 mb-2">
                   <strong>集中生產制 (Batch Production):</strong><br/>
                   將單一客戶月產量集中於 0.5 天完成，極大化產能。
                </div>
                <DecryptButton 
                  hiddenText={`【資產轉型戰略】\n我們現在投入的設備與半年人事練兵，不是「費用」，而是為了建立一座會自動運轉的「印鈔工廠」。\n\n曾仕強文化媒體部，將成為市場上唯一擁有「帝王學智慧」與「科學化戰力」的正規部隊。`}
                />
             </div>
          </GridCard>

        </div>
        {/* --- GRID SYSTEM END --- */}

        {/* FOOTER */}
        <footer className="mt-16 pt-8 border-t border-gray-800 text-center md:text-left flex flex-col md:flex-row justify-between items-center text-xs font-mono text-gray-600">
          <div>© 2026 TSENG CULTURE MEDIA CENTER. ALL RIGHTS RESERVED.</div>
          <div className="mt-4 md:mt-0 flex gap-4">
            <span>SECURE CONNECTION: ENCRYPTED</span>
            <span className="text-cyan-900">|</span>
            <span>NO: 2026-SMU-FINAL</span>
          </div>
        </footer>

      </div>
    </div>
  );
};

export default App;